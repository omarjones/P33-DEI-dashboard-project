library("tidyverse")
library("dplyr")
library("tidyr")
library('ggfortify')
library('stargazer')
library('pscl')
getwd()
setwd('E:/p33/P33-DEI-dashboard-project/DEI_CSV')
df_DEI_demo <- read.csv('df_demo_v3.CSV')
df_DEI_parametric <- read.csv('df_parametrics_v2.csv')
# lower cases in demo col
df_DEI_parametric_lower <- df_DEI_parametric %>%
mutate(Demographic = tolower(Demographic))
# create cols of variables: var_x
df_DEI_parametric_mutated <- df_DEI_parametric_lower %>%
## drop redundant observations
filter(Demographic != "usa-illinois cs/computing conferral(emsi)" |
Demographic != "usa employment - illinois employment for 11 top tech jobs (emsi)" |
Demographic != "usa sat benchmark - cps sat benchmark" ) %>%
## create var_dim
mutate(var_dim = case_when(
### proficiency
str_detect(Demographic,"proficient") ~ "proficiency",
str_detect(Demographic,"persistent") ~ "proficiency",
str_detect(Demographic,"conferral") ~ "proficiency",
str_detect(Demographic,"benchmark") ~ "proficiency",
str_detect(Demographic,"meets and exceeds") ~ "proficiency",
str_detect(Demographic,"employee demographics") ~ "proficiency",
### access
str_detect(Demographic,"enrollment") ~ "access",
str_detect(Demographic,"enroll") ~ "access",
### excellence
str_detect(Demographic,"advanced") ~ "excellence",
str_detect(Demographic,"pass") ~ "excellence",
str_detect(Demographic,"top three") ~ "excellence",
str_detect(Demographic,"top") ~ "excellence",
str_detect(Demographic,"high") ~ "excellence",
str_detect(Demographic,"exceeds") ~ "excellence",
### access
str_detect(Demographic,"19-24") ~ "access",
str_detect(Demographic,"19-24") ~ "access"
)
) %>%
mutate(var_dim = case_when(
## revision: three top school enrollment to excellence
str_detect(Demographic,"mit") ~ "excellence",
str_detect(Demographic,"stanford") ~ "excellence",
str_detect(Demographic,"carnegie") ~ "excellence",
TRUE ~ var_dim
)
) %>%
## Create scope var.
mutate(var_scope = case_when(
str_detect(Demographic,"mit") |
str_detect(Demographic,"stanford") |
str_detect(Demographic,"carnegie") ~ "college",
str_detect(Demographic,"msa") ~ "region_chi_msa",
str_detect(Demographic,"cps") |
str_detect(Demographic,"in math") ~ "city_chi",
str_detect(Demographic,"illinois") |
str_detect(Demographic,"ibhe")~ "state_il",
str_detect(Demographic,"usa") ~ "usa"
)
) %>%
## create var_key.
mutate(var_key = case_when(
str_detect(Demographic,"math") ~ "math",
str_detect(Demographic,"cs") ~ "cs",
str_detect(Demographic,"stem") ~ "stem",
str_detect(Demographic,"tech") |
str_detect(Demographic,"jobs")~ "jobs",
str_detect(Demographic,"sat") ~ "sat",
str_detect(Demographic,"enrollment") |
str_detect(Demographic,"enroll") ~ "enrollment",
str_detect(Demographic,"conferral") ~ "conferral"
)
) %>%
## create var_key.
mutate(var_stage = case_when(
str_detect(Demographic,"4th") |
str_detect(Demographic,"8th") |
str_detect(Demographic,"k-8") ~ "k8",
str_detect(Demographic,"sat") |
str_detect(Demographic,"ap") |
str_detect(Demographic,"hs") ~ "hs",
str_detect(Demographic,"college") |
str_detect(Demographic,"universities") |
str_detect(Demographic,"degree") |
str_detect(Demographic,"mit") |
str_detect(Demographic,"stanford") |
str_detect(Demographic,"computing") ~ "col",
str_detect(Demographic,"employee") |
str_detect(Demographic,"jobs") |
str_detect(Demographic,"tech") ~ "emp")
) %>%
## create var_source
mutate(var_source = str_extract(Demographic,"(?<=\\().+?(?=\\))")
) %>%
## create new var for ethnic groups
mutate(Black_Hispanic = Black + Hispanic,
White_Asian = White + Asian) %>%
## create year var (var_yr_obs for the year observations are made)
mutate(var_yr_obs = 2021) %>%
## reorganize the order of cols for pivot_longer
select(All,Black_Hispanic,White_Asian,Black,Hispanic,White,Asian,everything())
colnames(df_DEI_parametric_mutated)
df_DEI_parametric_mutated_long <- df_DEI_parametric_mutated %>%
pivot_longer(1:7,names_to = "var_ethinc",values_to = "var_popul") %>%
mutate(var_ethinc = tolower(var_ethinc))
write.csv(df_DEI_parametric_mutated_long,"E:/p33/P33-DEI-dashboard-project/df_DEI_parametric_tidy.csv", row.names = FALSE)
colnames(df_DEI_demo)
df_DEI_demo_long <- df_DEI_demo %>%
mutate(Demographics = tolower(Demographics)) %>%
select(- estimated) %>%
mutate(White = as.numeric(White)) %>%
pivot_longer(2:6,
names_to = "var_ethnic",
values_to = "population")
# create cols of variables: var_x
df_DEI_demo_mutated_long <- df_DEI_demo_long %>%
## create var. of scope
mutate(var_scope = case_when(
str_detect(Demographics,"chicago msa") ~ "region_chi_msa",
str_detect(Demographics,"cps") |
str_detect(Demographics,"chicago naep") |
str_detect(Demographics,"all people in chicago")~ "city_chi",
str_detect(Demographics,"illinois") ~ "state_il",
str_detect(Demographics,"us") |
str_detect(Demographics,"usa") |
str_detect(Demographics,"national") ~ "usa" )
) %>%
## educational stage
mutate(var_stage = case_when(
str_detect(Demographics,"4th") |
str_detect(Demographics,"8th") |
str_detect(Demographics,"k-8") ~ "k8",
str_detect(Demographics,"9th") |
str_detect(Demographics,"10th") |
str_detect(Demographics,"11th") |
str_detect(Demographics,"12th") |
str_detect(Demographics,"sat") |
str_detect(Demographics,"highschool") |
str_detect(Demographics,"hs") ~ "hs",
str_detect(Demographics,"college") |
str_detect(Demographics,"degrees") |
str_detect(Demographics,"18-24")  ~ "col",
str_detect(Demographics,"employee") |
str_detect(Demographics,"jobs") |
str_detect(Demographics,"20-64") |
str_detect(Demographics,"tech") |
str_detect(Demographics,"us population") |
str_detect(Demographics,"all people") ~ "emp")
)  %>%
## create variable indicates sample or population
mutate(var_sampleValue = ifelse(str_detect(Demographics,"naep"),1,0
)
)%>%
## create var_source
mutate(var_source = str_extract(Demographics,"(?<=\\().+?(?=\\))")
) %>%
## create variable of years
mutate(var_yr_ob = case_when(
str_detect(Demographics," 2022") ~ 2022,
str_detect(Demographics,"2021-2022") ~ 2021,
str_detect(Demographics,"2020") ~ 2020,
str_detect(Demographics,"2019") ~ 2019,
TRUE ~ 2021)
) %>%
## create variable of grades
mutate(x = case_when(
str_detect(Demographics,"4th grade") ~ "k8_4th",
str_detect(Demographics,"8th grade") ~ "k8_8th",
str_detect(Demographics,"k-8") ~ "k8_total",
str_detect(Demographics,"cps 9th grade") ~ "hs_9th",
str_detect(Demographics,"cps 10th grade") ~ "hs_10th",
str_detect(Demographics,"cps 11th grade") ~ "hs_11th",
str_detect(Demographics,"cps 12th grade") |
str_detect(Demographics,"hs seniors") ~ "hs_12th",
str_detect(Demographics,"hs graduates") |
str_detect(Demographics,"us highschool graduates") ~ "hs_grads",
str_detect(Demographics,"cps hs") |
str_detect(Demographics,"all highschool")|
str_detect(Demographics,"us highschool population") ~ "hs_total",
str_detect(Demographics,"sat takers") ~ "hs_SATtaker",
str_detect(Demographics,"all college students") ~ "col_total",
str_detect(Demographics,"all degrees conferred") ~ "col_conferred",
str_detect(Demographics,"us population") ~ "national_total",
str_detect(Demographics,"all people in chicago ") ~ "city_total",
str_detect(Demographics,"18-24") ~ "age_18to24",
str_detect(Demographics,"20-64") ~ "age_20to64")
)
colnames(df_DEI_demo_mutated_long)
df_DEI_demo_tidy <- df_DEI_demo_mutated_long %>%
rename(note = Demographics,
demographics = x) %>%
filter(note != 'all college students - all cs/computing degree enrollment') %>%
select(var_yr_ob,demographics,var_sampleValue,var_ethnic,var_scope,var_stage,population,note,var_source)
write.csv(df_DEI_demo_mutated_long,"E:/p33/P33-DEI-dashboard-project/df_DEI_demo_tidy_for_review 07281007.csv", row.names = FALSE)
